<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PDF.js Canvas Viewer (No Toolbar)</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #333;
    color: #eee;
    user-select: none;
  }
  #message {
    padding: 1em;
    text-align: center;
    font-size: 1.2em;
    margin-top: 2em;
  }
  #pdf-container {
    width: 100%;
    max-width: 900px;
    margin: 1em auto;
    background: #444;
    box-shadow: 0 0 10px #000;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }
  canvas {
    display: block;
    margin: 1em auto;
    box-shadow: 0 0 5px #000;
    border: 1px solid #666;
    user-select: none;
  }
  #cors-warning {
    margin: 1em auto;
    max-width: 900px;
    background: #a33;
    color: #fff;
    padding: 1em;
    border-radius: 5px;
    font-size: 0.9em;
  }
</style>
</head>
<body>
<div id="message">Loading PDF viewer...</div>
<div id="cors-warning" style="display:none;">
  <strong>CORS Error:</strong> Failed to fetch the PDF file.<br />
  Please ensure the server hosting the PDF allows cross-origin requests by sending the header:<br />
  <code>Access-Control-Allow-Origin: *</code><br />
  or your domain.<br />
  If you control the server, please configure CORS properly.<br />
  Otherwise, try hosting the PDF on a server with CORS enabled.
</div>
<div id="pdf-container" style="display:none;"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.6.172/pdf.min.js"></script>
<script>
  // Configure PDF.js workerSrc
  pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.6.172/pdf.worker.min.js';

  // Utility: get query param 'file'
  function getQueryParam(name) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(name);
  }

  // Disable right-click context menu on whole document
  document.addEventListener('contextmenu', function(e) {
    e.preventDefault();
  });

  // Disable text selection on body
  document.body.style.userSelect = 'none';

  // Block common keyboard shortcuts for save/print
  document.addEventListener('keydown', function(e) {
    // Ctrl/Cmd + S or P or Shift+S or U
    if (
      (e.ctrlKey || e.metaKey) &&
      (e.key === 's' || e.key === 'S' || e.key === 'p' || e.key === 'P' || e.key === 'u' || e.key === 'U')
    ) {
      e.preventDefault();
      alert('Save, Print, and View Source shortcuts are disabled.');
    }
  });

  // Override window.print to disable printing
  window.print = function() {
    alert('Printing is disabled.');
  };

  // Prevent beforeprint event
  window.addEventListener('beforeprint', function(e) {
    e.preventDefault();
    alert('Printing is disabled.');
  });

  const pdfUrl = getQueryParam('file');
  const messageEl = document.getElementById('message');
  const container = document.getElementById('pdf-container');
  const corsWarning = document.getElementById('cors-warning');

  if (!pdfUrl) {
    messageEl.textContent = 'No PDF file specified. Please provide a PDF URL in the "file" query parameter.';
  } else {
    messageEl.textContent = 'Loading PDF...';

    // Fetch PDF as ArrayBuffer
    fetch(pdfUrl, {
      // mode: 'cors', // uncomment if needed
      // credentials: 'include' // uncomment if needed
    }).then(function(response) {
      if (!response.ok) {
        throw new Error('Network response was not ok: ' + response.statusText);
      }
      return response.arrayBuffer();
    }).then(function(data) {
      messageEl.style.display = 'none';
      container.style.display = 'block';

      // Load PDF document from data
      const loadingTask = pdfjsLib.getDocument({data: data});
      loadingTask.promise.then(function(pdf) {
        // Render all pages
        const numPages = pdf.numPages;

        // Render pages sequentially to avoid blocking UI
        let pageNum = 1;

        function renderPage(num) {
          pdf.getPage(num).then(function(page) {
            const viewport = page.getViewport({scale: 1.5});
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.height = viewport.height;
            canvas.width = viewport.width;
            canvas.style.userSelect = 'none';
            canvas.style.webkitUserSelect = 'none';
            canvas.style.MozUserSelect = 'none';
            canvas.style.msUserSelect = 'none';

            // Disable right-click on canvas
            canvas.addEventListener('contextmenu', function(e) {
              e.preventDefault();
            });

            container.appendChild(canvas);

            const renderContext = {
              canvasContext: context,
              viewport: viewport
            };
            const renderTask = page.render(renderContext);
            renderTask.promise.then(function() {
              pageNum++;
              if (pageNum <= numPages) {
                renderPage(pageNum);
              }
            });
          });
        }

        renderPage(pageNum);
      }, function(reason) {
        messageEl.style.display = 'block';
        messageEl.textContent = 'Error loading PDF: ' + reason.message;
      });
    }).catch(function(error) {
      messageEl.style.display = 'none';
      corsWarning.style.display = 'block';
      console.error('Fetch error:', error);
    });
  }
</script>
</body>
</html>
