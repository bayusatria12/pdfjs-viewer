<!DOCTYPE html>
<!-- Minimalized PDF.js viewer (toolbar/sidebar disembunyikan; download link tersedia) -->
<html dir="ltr" mozdisallowselectionprint>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="google" content="notranslate">
    <title>PDF.js viewer (no toolbar)</title>

    <!-- resource for localization (kept) -->
    <link rel="resource" type="application/l10n" href="locale/locale.json">
    <script src="../build/pdf.mjs" type="module"></script>

    <!-- gunakan stylesheet asli atau minimal -->
    <link rel="stylesheet" href="viewer.css">

    <script src="viewer.mjs" type="module"></script>

    <style>
      /* Sembunyikan toolbar dan sidebar seluruhnya */
      #sidebarContainer, .toolbar, #toolbarSidebar, #sidebarResizer, #toolbarContainer {
        display: none !important;
      }

      /* Atur tampilan kontainer utama supaya memenuhi layar */
      #mainContainer { width: 100% !important; margin: 0; padding: 0; }
      #viewerContainer, #viewer { margin: 0; padding: 0; }

      /* Tombol download yang simpel (kanan atas) */
      #downloadWrapper {
        position: fixed;
        top: 12px;
        right: 12px;
        z-index: 9999;
        background: rgba(0,0,0,0.6);
        color: #fff;
        padding: 8px 12px;
        border-radius: 6px;
        font-family: sans-serif;
        font-size: 14px;
      }
      #downloadWrapper a {
        color: #fff;
        text-decoration: none;
      }
      #downloadWrapper button {
        background: #1a73e8;
        border: none;
        color: white;
        padding: 6px 10px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
      }

      /* Opsional: sembunyikan elemen lain yang tidak terpakai */
      .hidden, .visuallyHidden { display: none !important; }
    </style>
  </head>

  <body tabindex="0">
    <div id="outerContainer">
      <span id="viewer-alert" class="visuallyHidden" role="alert"></span>

      <!-- sidebarContainer dan isinya disembunyikan via CSS -->
      <div id="sidebarContainer">
        <div id="toolbarSidebar" class="toolbarHorizontalGroup">
          <!-- isi asli disembunyikan -->
        </div>
        <div id="sidebarContent"></div>
        <div id="sidebarResizer"></div>
      </div>

      <div id="mainContainer">
        <!-- toolbar asli dihapus/di-hide -->
        <div class="toolbar" style="display:none">
          <div id="toolbarContainer" style="display:none">
            <div id="toolbarViewer" class="toolbarHorizontalGroup"></div>
          </div>
        </div>

        <!-- PDF viewer utama (biarkan struktur PDF.js agar tetap bekerja) -->
        <div id="viewerContainer" tabindex="0">
          <div id="viewer" class="pdfViewer"></div>
        </div>
      </div> <!-- mainContainer -->
    </div> <!-- outerContainer -->

    <!-- Wrapper tombol download / copy link -->
    <div id="downloadWrapper" role="region" aria-label="download PDF">
      <span id="downloadText">File:</span>
      <a id="downloadLink" href="#" download><button id="downloadBtn">Download PDF</button></a>
    </div>

    <script>
      // Helper: ambil parameter query 'file'
      function getQueryFile() {
        const params = new URLSearchParams(location.search);
        const f = params.get('file');
        if (f && f.trim()) {
          return f;
        }
        // kalau tidak ada, coba atribut data-file pada body atau berikan file default
        return null;
      }

      // Atur link download supaya menunjuk ke file yang sama
      (function setupDownloadLink() {
        const file = getQueryFile();
        const downloadLink = document.getElementById('downloadLink');
        const downloadText = document.getElementById('downloadText');

        if (file) {
          // jika file adalah URL relatif/absolute, isi href langsung
          downloadLink.href = file;
          downloadLink.setAttribute('download', '');
          downloadText.textContent = 'File: ' + file;
        } else {
          // Tidak ada parameter file: coba cari dokumen yang sedang dimuat oleh PDF.js
          // PDF.js biasanya menginisialisasi beberapa objek; kita coba deteksi url dari PDFViewerApplication
          if (window.PDFViewerApplication && window.PDFViewerApplication.url) {
            const url = window.PDFViewerApplication.url;
            downloadLink.href = url;
            downloadLink.setAttribute('download', '');
            downloadText.textContent = 'File: ' + url;
          } else {
            // fallback: nonaktifkan tombol dan tampilkan petunjuk
            downloadLink.removeAttribute('href');
            downloadLink.removeAttribute('download');
            document.getElementById('downloadBtn').textContent = 'Tidak ada file';
            downloadText.textContent = 'Tidak ada file terdeteksi';
          }
        }
      })();

      // Jika Anda ingin juga menyalin link file ke clipboard
      document.getElementById('downloadBtn').addEventListener('contextmenu', function (e) {
        // klik kanan pada tombol akan menyalin URL ke clipboard (jika ada)
        e.preventDefault();
        const link = document.getElementById('downloadLink').href;
        if (link) {
          navigator.clipboard?.writeText(link).then(function () {
            alert('Link tersalin ke clipboard:\n' + link);
          }, function () {
            alert('Gagal menyalin link ke clipboard.');
          });
        }
      });
    </script>
  </body>
</html>
